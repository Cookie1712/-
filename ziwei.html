<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç„å­¦ - æ¯æ—¥è¿åŠ¿ & ç´«å¾®æ’ç›˜ (v10.3 æœ¬åœ°ç‰ˆ)</title>
    
    <script src="https://npm.elemecdn.com/tailwindcss@3.3.3/lib/index.min.js"></script>
    
    <script src="./lunar.js"></script>
    <script>if(typeof Lunar==='undefined'){document.write('<script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.7.7/lunar.min.js"><\/script>')}</script>

    <script src="./iztro.min.js"></script>
    <script>if(typeof iztro==='undefined'){document.write('<script src="https://npm.elemecdn.com/iztro@2.6.3/dist/iztro.min.js"><\/script>')}</script>

    <style>
        body { font-family: -apple-system, "Microsoft YaHei", sans-serif; background-color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        select { -webkit-appearance: none; background-color: #fff; background-image: url("data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E"); background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem; }
        .tab-active { background-color: #4f46e5; color: white; font-weight: bold; }
        .tab-inactive { background-color: #eef2ff; color: #6366f1; }
        .gua-line { height: 6px; margin-bottom: 4px; border-radius: 2px; }
        .gua-yang { background-color: #334155; width: 100%; }
        .gua-yin { display: flex; justify-content: space-between; width: 100%; }
        .gua-yin span { background-color: #334155; width: 42%; height: 100%; border-radius: 2px; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center pb-10">

    <div class="sticky top-0 z-50 w-full max-w-md bg-white/90 backdrop-blur shadow-sm p-2 flex gap-3 border-b border-slate-100">
        <button onclick="switchTab('daily')" id="tab-daily" class="flex-1 py-2.5 rounded-xl text-sm transition-all tab-active">
            ğŸ“… ä»Šæ—¥æ˜“ç»
        </button>
        <button onclick="switchTab('ziwei')" id="tab-ziwei" class="flex-1 py-2.5 rounded-xl text-sm transition-all tab-inactive">
            ğŸ”® ç´«å¾®æµæœˆ
        </button>
    </div>

    <div class="w-full max-w-md px-4 py-4 space-y-4">

        <div id="view-daily" class="fade-in space-y-4">
            <div class="bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl p-5 text-white shadow-lg relative overflow-hidden">
                <div class="absolute right-0 top-0 w-24 h-24 bg-white/5 rounded-full blur-xl -mr-8 -mt-8"></div>
                <div class="flex justify-between items-center">
                    <div>
                        <div class="text-3xl font-bold" id="dailyDate">--</div>
                        <div class="text-sm text-slate-300 mt-1" id="dailyLunar">æ­£åœ¨åŠ è½½æœ¬åœ°åº“...</div>
                    </div>
                    <div class="text-right">
                        <div class="text-xl font-bold text-amber-400" id="dailyGanzhi">--</div>
                        <div class="text-xs text-slate-400 border border-slate-600 rounded px-1.5 py-0.5 mt-1 inline-block" id="dailyNayin">--</div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="font-bold text-slate-800 flex items-center"><span class="text-xl mr-2">â˜¯ï¸</span> å€¼æ—¥å¦è±¡</h3>
                    <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-full">å‘¨æ˜“å…­åå››å¦</span>
                </div>
                <div class="flex gap-5 items-center bg-slate-50 rounded-xl p-4">
                    <div id="gua-lines" class="w-12 flex flex-col-reverse shrink-0"></div>
                    <div>
                        <div class="text-lg font-bold text-slate-800 mb-1" id="gua-name">--</div>
                        <div class="text-sm text-slate-600 leading-relaxed" id="gua-desc">--</div>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <div class="text-xs text-slate-400 font-bold mb-2 uppercase tracking-wider">å¹¸è¿è‰² & ç©¿æ­</div>
                    <div class="flex items-center gap-3">
                        <div id="lucky-color-dot" class="w-8 h-8 rounded-full shadow-inner border-2 border-white ring-1 ring-slate-100"></div>
                        <div class="font-bold text-slate-700" id="lucky-color-text">--</div>
                    </div>
                </div>
                <div class="bg-white rounded-2xl p-4 shadow-sm border border-slate-100">
                    <div class="text-xs text-slate-400 font-bold mb-2 uppercase tracking-wider">å¼€è¿å°ç‰©</div>
                    <div class="text-2xl mb-1" id="lucky-item-icon">ğŸ“¿</div>
                    <div class="text-sm font-bold text-slate-700" id="lucky-item-text">--</div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-5 shadow-sm border border-slate-100">
                <h3 class="font-bold text-slate-800 mb-3">ğŸ“œ è€é»„å†å®œå¿Œ</h3>
                <div class="space-y-2">
                    <div class="flex items-start">
                        <span class="bg-emerald-100 text-emerald-700 text-xs font-bold px-2 py-0.5 rounded mt-0.5 shrink-0 mr-2">å®œ</span>
                        <div class="flex flex-wrap gap-1" id="almanac-yi">--</div>
                    </div>
                    <div class="flex items-start">
                        <span class="bg-rose-100 text-rose-700 text-xs font-bold px-2 py-0.5 rounded mt-0.5 shrink-0 mr-2">å¿Œ</span>
                        <div class="flex flex-wrap gap-1" id="almanac-ji">--</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-ziwei" class="hidden fade-in bg-white rounded-2xl shadow-lg border border-slate-100 p-5">
            <div class="text-center mb-5">
                <h2 class="text-lg font-bold text-slate-800">ğŸ”¯ ç´«å¾®æµæœˆæ’ç›˜</h2>
                <p class="text-xs text-slate-400 mt-1">æœ¬åœ°ç¦»çº¿ç‰ˆ Â· é¢„æµ‹æœªæ¥ä¸‰ä¸ªæœˆè¿åŠ¿</p>
            </div>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1.5">å‡ºç”Ÿæ—¥æœŸ (é˜³å†)</label>
                    <div class="flex space-x-2">
                        <select id="selYear" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500"></select>
                        <select id="selMonth" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500"></select>
                        <select id="selDay" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500"></select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5">æ—¶é—´</label>
                        <input type="time" id="birthTime" value="12:00" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 mb-1.5">æ€§åˆ«</label>
                        <select id="gender" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500">
                            <option value="å¥³">å¥³</option>
                            <option value="ç”·">ç”·</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-1.5">å‡ºç”Ÿåœ°</label>
                    <input type="text" id="location" placeholder="å¦‚: æµ·å—æµ·å£" class="w-full border border-slate-300 rounded-lg p-2 text-sm h-10 outline-none focus:border-indigo-500">
                </div>
                <button onclick="calculateZiwei()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl transition shadow-md text-sm">
                    ğŸš€ å¼€å§‹æ’ç›˜
                </button>
            </div>
            <div id="ziwei-result" class="mt-6 hidden space-y-4"></div>
        </div>
        
        <div id="explainModal" class="fixed inset-0 z-50 hidden flex items-center justify-center px-4">
            <div class="absolute inset-0 bg-black/50 backdrop-blur-sm" onclick="closeModal()"></div>
            <div class="bg-white rounded-xl shadow-2xl w-full max-w-xs p-6 relative z-10">
                <h3 id="modalTitle" class="text-lg font-bold text-slate-800 mb-2"></h3>
                <p id="modalDesc" class="text-sm text-slate-600 leading-relaxed mb-4"></p>
                <button onclick="closeModal()" class="w-full bg-slate-100 text-slate-700 py-2 rounded-lg text-sm font-bold">å…³é—­</button>
            </div>
        </div>
    </div>

    <script>
        // ================= ç•Œé¢åˆ‡æ¢ =================
        function switchTab(tab) {
            const vDaily = document.getElementById('view-daily');
            const vZiwei = document.getElementById('view-ziwei');
            const tDaily = document.getElementById('tab-daily');
            const tZiwei = document.getElementById('tab-ziwei');
            if (tab === 'daily') {
                vDaily.classList.remove('hidden'); vZiwei.classList.add('hidden');
                tDaily.className = "flex-1 py-2.5 rounded-xl text-sm transition-all tab-active";
                tZiwei.className = "flex-1 py-2.5 rounded-xl text-sm transition-all tab-inactive";
            } else {
                vDaily.classList.add('hidden'); vZiwei.classList.remove('hidden');
                tDaily.className = "flex-1 py-2.5 rounded-xl text-sm transition-all tab-inactive";
                tZiwei.className = "flex-1 py-2.5 rounded-xl text-sm transition-all tab-active";
            }
        }

        // ================= æ¯æ—¥ç„å­¦ =================
        const GUA_DICT = {
            '111111': { name: 'ä¹¾ä¸ºå¤©', desc: 'å…ƒäº¨åˆ©è´ã€‚åˆšå¥ä¸­æ­£ï¼Œè‡ªå¼ºä¸æ¯ã€‚æ˜¯å¤§å‰ä¹‹å¦ï¼Œå®œè¿›å–ã€‚' },
            '000000': { name: 'å¤ä¸ºåœ°', desc: 'åšå¾·è½½ç‰©ã€‚æŸ”é¡ºåŒ…å®¹ï¼Œä»¥é™åˆ¶åŠ¨ã€‚åˆ©äºåˆä½œï¼Œä¸å®œå†’è¿›ã€‚' },
            '100010': { name: 'æ°´é›·å±¯', desc: 'ä¸‡ç‰©å§‹ç”Ÿã€‚åˆæœŸè‰°éš¾ï¼Œå¦‚åŒå¹¼è‹—ç ´åœŸã€‚å®œç§¯æ”’å®åŠ›ã€‚' },
            '010001': { name: 'å±±æ°´è’™', desc: 'å¯è’™ä¹‹æ—¶ã€‚è¿·é›¾é‡é‡ã€‚å®œè¯·æ•™é•¿è¾ˆï¼Œåˆ‡å¿Œè‡ªä½œèªæ˜ã€‚' },
            '111010': { name: 'æ°´å¤©éœ€', desc: 'ç­‰å¾…æ—¶æœºã€‚é¥®é£Ÿå®´ä¹ï¼Œè€å¿ƒç­‰å¾…ã€‚å‰é€”å…‰æ˜ä½†æœ‰é˜»ç¢ã€‚' },
            '010111': { name: 'å¤©æ°´è®¼', desc: 'äº‰æ‰§ä¸ä¸‹ã€‚å‡¡äº‹æ˜“èµ·å£èˆŒï¼Œå®˜éã€‚å®œé€€è®©ï¼Œä»¥å’Œä¸ºè´µã€‚' },
            '010000': { name: 'åœ°æ°´å¸ˆ', desc: 'å…´å¸ˆåŠ¨ä¼—ã€‚åˆ©äºå›¢é˜Ÿé¢†å¯¼ï¼Œè¡Œäº‹éœ€æœ‰çºªå¾‹ã€‚' },
            '000010': { name: 'æ°´åœ°æ¯”', desc: 'äº²å¯†æ¯”è¾…ã€‚æœ‹å‹äº’åŠ©ã€‚åˆ©äºåˆä½œã€å»ºäº¤ï¼Œäººç¼˜æä½³ã€‚' }
        };

        const FIVE_ELEMENTS_CONFIG = {
            'æœ¨': { color: 'bg-emerald-500', text: 'é’/ç»¿', items: 'ğŸ“š ä¹¦ç±ã€ğŸª´ æ¤ç‰©ã€ğŸ§£ æ£‰éº»', icon: 'ğŸª´' },
            'ç«': { color: 'bg-rose-500', text: 'çº¢/ç´«', items: 'ğŸ”¦ ç”µå­ã€ğŸ® ç¯å…·ã€ğŸ•¶ï¸ çœ¼é•œ', icon: 'ğŸ”¥' },
            'åœŸ': { color: 'bg-amber-500', text: 'é»„/å’–', items: 'ğŸª¨ ç‰çŸ³ã€ğŸº é™¶ç“·ã€ğŸ¯ ç”œé£Ÿ', icon: 'ğŸ“¿' },
            'é‡‘': { color: 'bg-slate-400', text: 'ç™½/é‡‘', items: 'âŒš æ‰‹è¡¨ã€ğŸ’ é¥°å“ã€ğŸª™ ç¡¬å¸', icon: 'âŒš' },
            'æ°´': { color: 'bg-blue-500', text: 'é»‘/è“', items: 'ğŸ’§ æ°´æ¯ã€ğŸš è´å£³ã€ğŸ§Š æ°´æ™¶', icon: 'ğŸ’§' }
        };

        function renderDaily() {
            // æ£€æŸ¥åº“æ˜¯å¦åŠ è½½
            if (typeof Lunar === 'undefined') { setTimeout(renderDaily, 200); return; }

            const today = new Date();
            const lunar = Lunar.fromDate(today);
            
            document.getElementById('dailyDate').innerText = `${today.getMonth()+1}æœˆ${today.getDate()}æ—¥`;
            document.getElementById('dailyLunar').innerText = `å†œå†${lunar.getMonthInChinese()}æœˆ${lunar.getDayInChinese()}`;
            document.getElementById('dailyGanzhi').innerText = `${lunar.getYearInGanZhi()}å¹´ ${lunar.getDayInGanZhi()}æ—¥`;
            document.getElementById('dailyNayin').innerText = lunar.getDayNaYin();

            const yi = lunar.getDayYi(); const ji = lunar.getDayJi();
            document.getElementById('almanac-yi').innerHTML = yi.slice(0,5).map(t=>`<span class="text-xs bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded">${t}</span>`).join('');
            document.getElementById('almanac-ji').innerHTML = ji.slice(0,5).map(t=>`<span class="text-xs bg-slate-100 text-slate-600 px-1.5 py-0.5 rounded">${t}</span>`).join('');

            const dayGan = lunar.getDayGan();
            let element = '';
            if (['ç”²','ä¹™'].includes(dayGan)) element = 'æœ¨';
            else if (['ä¸™','ä¸'].includes(dayGan)) element = 'ç«';
            else if (['æˆŠ','å·±'].includes(dayGan)) element = 'åœŸ';
            else if (['åºš','è¾›'].includes(dayGan)) element = 'é‡‘';
            else element = 'æ°´';

            const config = FIVE_ELEMENTS_CONFIG[element];
            document.getElementById('lucky-color-dot').className = `w-8 h-8 rounded-full shadow-inner border-2 border-white ring-1 ring-slate-100 ${config.color}`;
            document.getElementById('lucky-color-text').innerText = config.text;
            document.getElementById('lucky-item-icon').innerText = config.icon;
            document.getElementById('lucky-item-text').innerText = config.items.split('ã€')[0];

            const y = today.getFullYear(); const m = today.getMonth()+1; const d = today.getDate();
            const sum = y + m + d;
            let upper = sum % 8; if(upper===0) upper=8;
            let lower = (sum + d) % 8; if(lower===0) lower=8;
            renderGua(upper, lower);
        }

        function renderGua(upper, lower) {
            const BAGUA_BIN = [null, '111', '011', '101', '001', '110', '010', '100', '000']; 
            const BAGUA_NAME = [null, 'ä¹¾', 'å…‘', 'ç¦»', 'éœ‡', 'å·½', 'å', 'è‰®', 'å¤'];
            const binCode = BAGUA_BIN[upper] + BAGUA_BIN[lower]; 
            const guaName = GUA_DICT[binCode] ? GUA_DICT[binCode].name : `${BAGUA_NAME[upper]}ä¸ºä¸Š${BAGUA_NAME[lower]}ä¸ºä¸‹`;
            const guaDesc = GUA_DICT[binCode] ? GUA_DICT[binCode].desc : 'ä»Šæ—¥è¿åŠ¿å¹³ç¨³ï¼Œé¡ºåŠ¿è€Œä¸ºï¼Œä¿æŒå†…å¿ƒå¹³é™å³å¯ã€‚æ˜“ç»å¯ç¤ºï¼šå˜åŠ¨ä¹‹ä¸­å¯»æ‰¾å¹³è¡¡ã€‚';

            document.getElementById('gua-name').innerText = guaName;
            document.getElementById('gua-desc').innerText = guaDesc;
            const container = document.getElementById('gua-lines');
            container.innerHTML = '';
            for (let char of binCode) {
                const div = document.createElement('div');
                div.className = "gua-line";
                if (char === '1') div.innerHTML = '<div class="gua-yang"></div>';
                else div.innerHTML = '<div class="gua-yin"><span></span><span></span></div>';
                container.appendChild(div);
            }
        }

        // ================= ç´«å¾®æ–—æ•° =================
        const CITY_LONGITUDES = {'åŒ—äº¬':116.40,'ä¸Šæµ·':121.47,'å¹¿å·':113.26,'æ·±åœ³':114.05,'æµ·å£':110.32,'å‘¨å£':114.65,'éƒ‘å·':113.62,'æ­¦æ±‰':114.31,'æˆéƒ½':104.06};
        const STAR_WIKI = {
            'åŒ–ç¦„':'ã€è´¢å¯Œ/æƒ…ç¼˜ã€‘é¡ºé‚ï¼Œåƒç§‹å¤©æ”¶è·ã€‚','åŒ–æƒ':'ã€æƒåŠ›/æ§åˆ¶ã€‘æŒæƒï¼Œæœ‰è¡ŒåŠ¨åŠ›ä½†å›ºæ‰§ã€‚','åŒ–ç§‘':'ã€åå£°/è´µäººã€‘è€ƒè¿å¥½ï¼Œæœ‰äººèµè¯†ã€‚','åŒ–å¿Œ':'ã€é˜»ç¢/çº ç»“ã€‘ä¸é¡ºï¼Œå£èˆŒï¼Œæƒ³ä¸å¼€ã€‚',
            'ç¦„å­˜':'ã€å­˜æ¬¾ã€‘å®æ‰“å®çš„ç§¯è“„ã€‚','å¤©é©¬':'ã€å¥”æ³¢ã€‘å‡ºå·®æ—…æ¸¸ï¼Œè¶ŠåŠ¨è¶Šæœ‰é’±ã€‚','å·¦è¾…':'ã€å¹³è¾ˆè´µäººã€‘æœ‹å‹å¸®å¿™ã€‚','å³å¼¼':'ã€å¼‚æ€§è´µäººã€‘é¢å¤–åŠ©åŠ›ã€‚','å¤©é­':'ã€é•¿è¾ˆææ‹”ã€‘ç›´æ¥æœºä¼šã€‚','å¤©é’º':'ã€æš—ä¸­ç›¸åŠ©ã€‘é—´æ¥æœºé‡ã€‚',
            'æ“ç¾Š':'ã€åˆ‘ä¼¤ã€‘å†²çªï¼Œæ‰‹æœ¯ï¼Œä¹ŸæŒ‡å¼€æ‹“ã€‚','é™€ç½—':'ã€æ‹–å»¶ã€‘çº ç»“ï¼ŒåŸåœ°æ‰“è½¬ã€‚','ç«æ˜Ÿ':'ã€çˆ†å‘ã€‘çªå‘ï¼Œæ¨ªè´¢æˆ–å‘ç«ã€‚','é“ƒæ˜Ÿ':'ã€æš—äºã€‘ç”Ÿé—·æ°”ï¼Œç®—è®¡ã€‚'
        };

        (function() {
            const ySel = document.getElementById('selYear'), mSel = document.getElementById('selMonth'), dSel = document.getElementById('selDay');
            for(let i=new Date().getFullYear(); i>=1930; i--) ySel.add(new Option(i+'å¹´', i)); ySel.value=1990;
            for(let i=1; i<=12; i++) mSel.add(new Option(i+'æœˆ', i));
            const updateDay = () => {
                const dim = new Date(ySel.value, mSel.value, 0).getDate(); dSel.innerHTML='';
                for(let i=1; i<=dim; i++) dSel.add(new Option(i+'æ—¥', i));
            };
            ySel.onchange = updateDay; mSel.onchange = updateDay; updateDay();
            renderDaily();
        })();

        async function calculateZiwei() {
            const btn = document.querySelector('button[onclick="calculateZiwei()"]');
            // æ ¸å¿ƒæ£€æµ‹
            if (typeof iztro === 'undefined') { alert("æ ¸å¿ƒæ’ç›˜åº“æœªåŠ è½½ï¼\nè¯·æ£€æŸ¥ iztro.min.js æ˜¯å¦åœ¨åŒä¸€ç›®å½•ä¸‹ã€‚"); return; }
            
            const dateStr = `${document.getElementById('selYear').value}-${document.getElementById('selMonth').value.padStart(2,'0')}-${document.getElementById('selDay').value.padStart(2,'0')}`;
            const timeStr = document.getElementById('birthTime').value;
            const gender = document.getElementById('gender').value;
            const location = document.getElementById('location').value || '';

            btn.innerText = "â³ æ¨æ¼”ä¸­..."; btn.disabled = true;

            setTimeout(() => {
                try {
                    let long = 120; 
                    for(let k in CITY_LONGITUDES) if(location.includes(k)) long = CITY_LONGITUDES[k];
                    const offset = (long - 120) * 4;
                    const dt = new Date(`${dateStr}T${timeStr}:00`); dt.setMinutes(dt.getMinutes()+offset);
                    let idx = Math.floor((dt.getHours()+1)/2)%12;

                    const astrolabe = iztro.astro.bySolar(dateStr, idx, gender, true, 'zh-CN');
                    
                    const container = document.getElementById('ziwei-result');
                    container.innerHTML = ''; container.classList.remove('hidden');
                    const today = new Date();
                    
                    for(let i=0; i<3; i++) {
                        let target = new Date(today.getFullYear(), today.getMonth()+i, 15);
                        const tStr = `${target.getFullYear()}-${String(target.getMonth()+1).padStart(2,'0')}-15 12:00:00`;
                        const scope = astrolabe.horoscope(tStr);
                        if(scope) {
                            const pName = astrolabe.palace(scope.monthly.index).name;
                            let stars = [];
                            [scope.monthly.index, (scope.monthly.index+4)%12, (scope.monthly.index+8)%12].forEach(idx => {
                                astrolabe.palace(idx).majorStars.forEach(s=>stars.push(s));
                                astrolabe.palace(idx).minorStars.forEach(s=>stars.push(s));
                            });
                            
                            let good = stars.filter(s=>['åŒ–ç¦„','åŒ–æƒ','åŒ–ç§‘','ç¦„å­˜','å¤©é©¬','å·¦è¾…','å³å¼¼','å¤©é­','å¤©é’º'].some(k=>s.name.includes(k))).slice(0,3);
                            let bad = stars.filter(s=>['åŒ–å¿Œ','æ“ç¾Š','é™€ç½—','ç«æ˜Ÿ','é“ƒæ˜Ÿ','åœ°ç©º','åœ°åŠ«'].some(k=>s.name.includes(k))).slice(0,3);
                            
                            let html = `
                                <div class="bg-white rounded-xl p-4 border border-slate-100 shadow-sm">
                                    <div class="flex justify-between border-b border-slate-50 pb-2 mb-2">
                                        <div class="font-bold text-slate-800">${target.getFullYear()}å¹´${target.getMonth()+1}æœˆ</div>
                                        <div class="text-xs bg-indigo-50 text-indigo-600 px-2 py-1 rounded">æµæœˆåœ¨${pName}</div>
                                    </div>
                                    <div class="grid grid-cols-2 gap-2">
                                        <div class="bg-emerald-50 p-2 rounded">
                                            <div class="text-[10px] text-emerald-600 font-bold mb-1">å‰æ˜Ÿé«˜ç…§</div>
                                            <div class="flex flex-wrap gap-1">${good.map(s=>`<span class="text-xs bg-white text-emerald-700 px-1 rounded shadow-sm cursor-pointer" onclick="showExplain('${s.name}')">${s.name}</span>`).join('')||'-'}</div>
                                        </div>
                                        <div class="bg-rose-50 p-2 rounded">
                                            <div class="text-[10px] text-rose-600 font-bold mb-1">éœ€é˜²èŒƒ</div>
                                            <div class="flex flex-wrap gap-1">${bad.map(s=>`<span class="text-xs bg-white text-rose-700 px-1 rounded shadow-sm cursor-pointer" onclick="showExplain('${s.name}')">${s.name}</span>`).join('')||'-'}</div>
                                        </div>
                                    </div>
                                </div>`;
                            container.innerHTML += html;
                        }
                    }
                } catch(e) { alert("æ’ç›˜å‡ºé”™: "+e.message); }
                finally { btn.innerText = "ğŸš€ å¼€å§‹æ’ç›˜"; btn.disabled = false; }
            }, 200);
        }

        function showExplain(name) {
            let key = Object.keys(STAR_WIKI).find(k => name.includes(k));
            if(!key) return;
            document.getElementById('modalTitle').innerText = key;
            document.getElementById('modalDesc').innerText = STAR_WIKI[key];
            document.getElementById('explainModal').classList.remove('hidden');
        }
        function closeModal() { document.getElementById('explainModal').classList.add('hidden'); }
    </script>
</body>
</html>